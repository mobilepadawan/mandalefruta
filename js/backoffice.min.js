import{mostrarMensaje,obtenerEndpoint,armarFilaHTML,opciones}from"./utils.min.js";let operacion="";const dialog=document.querySelector("dialog"),URLproductos=obtenerEndpoint()||"",btnNuevo=document.querySelector("button.btn-nuevo"),btnGuardar=document.querySelector("button#btnGuardar"),btnEliminar=document.querySelector("button#btnEliminar"),inputId=document.querySelector("input#inputId"),inputImagen=document.querySelector("input#inputImagen"),inputNombre=document.querySelector("input#inputNombre"),inputPrecio=document.querySelector("input#inputPrecio"),selectCategoria=document.querySelector("select#selectCategoria"),tableBody=document.querySelector("table tbody#tableBody"),productos=[];function obtenerProductos(){fetch(URLproductos).then((e=>e.json())).then((e=>{productos.length=0,productos.push(...e)})).then((()=>{cargarProductos(),activarClicEditarProducto(),activarClicEliminarProducto()})).catch((e=>{let t=`Se ha producido un error: ${e.message}`;mostrarMensaje(t,"error")}))}function activarClicEditarProducto(){const e=document.querySelectorAll("td#editButton");e.length>0&&e.forEach((e=>{e.addEventListener("click",(()=>{let t=productos.find((t=>t.id===e.dataset.codigo));inputId.value=t.id,inputImagen.value=t.imagen,inputNombre.value=t.nombre,inputPrecio.value=t.precio,selectCategoria.value=t.categoria,btnEliminar.setAttribute("hidden","true"),btnGuardar.removeAttribute("hidden"),operacion="e",dialog.showModal()}))}))}function activarClicEliminarProducto(){const e=document.querySelectorAll("td#delButton");e.length>0&&e.forEach((e=>{e.addEventListener("click",(()=>{let t=productos.find((t=>t.id===e.dataset.codigo));inputId.value=t.id,inputImagen.value=t.imagen,inputNombre.value=t.nombre,inputPrecio.value=t.precio,selectCategoria.value=t.categoria,btnEliminar.removeAttribute("hidden"),btnGuardar.setAttribute("hidden","true"),dialog.showModal()}))}))}function cargarProductos(){if(productos.length>0){let e="";productos.forEach((t=>e+=armarFilaHTML(t))),tableBody.innerHTML=e}}obtenerProductos(),btnNuevo.addEventListener("click",(()=>{operacion="n",btnEliminar.setAttribute("hidden","true"),btnGuardar.removeAttribute("hidden"),inputId.value="",inputImagen.value="",inputNombre.value="",inputPrecio.value="",selectCategoria.value=selectCategoria[0].value,dialog.showModal()})),btnGuardar.addEventListener("click",(()=>{if("n"===operacion){let e={imagen:inputImagen.value,nombre:inputNombre.value,precio:parseFloat(inputPrecio.value),categoria:selectCategoria.value};opciones.method="POST",opciones.body=JSON.stringify(e),fetch(URLproductos,opciones).then((e=>e.json())).then((e=>{inputId.value=e.id,mostrarMensaje("Producto dado de alta.","success"),obtenerProductos()})).catch((e=>{let t=`Se ha producido un error: ${e.message}`;mostrarMensaje(t,"error")}))}else if("e"===operacion){let e={imagen:inputImagen.value,nombre:inputNombre.value,precio:parseFloat(inputPrecio.value),categoria:selectCategoria.value};opciones.method="PUT",opciones.body=JSON.stringify(e),fetch(`${URLproductos}/${inputId.value}`,opciones).then((e=>e.json())).then((e=>{mostrarMensaje("Producto modificado exitosamente.","success"),obtenerProductos()})).catch((e=>{let t=`Se ha producido un error: ${e.message}`;mostrarMensaje(t,"error")}))}})),btnEliminar.addEventListener("click",(()=>{opciones.method="DELETE",opciones.body="",fetch(`${URLproductos}/${inputId.value}`,opciones).then((e=>e.json())).then((e=>{mostrarMensaje("Producto eliminado exitosamente.","alert"),obtenerProductos()})).catch((e=>{let t=`Se ha producido un error: ${e.message}`;mostrarMensaje(t,"error")}))}));